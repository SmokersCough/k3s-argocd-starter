# Longhorn values.yaml for ArgoCD (compatible with kustomize-build-with-helm)
global:
  cattle:
    systemDefaultRegistry: ""
    windowsCluster:
      enabled: false
      tolerations:
      - key: "cattle.io/os"
        value: "linux"
        effect: "NoSchedule"
        operator: "Equal"
      nodeSelector:
        kubernetes.io/os: "linux"
      defaultSetting:
        taintToleration: cattle.io/os=linux:NoSchedule
        systemManagedComponentsNodeSelector: kubernetes.io/os:linux

service:
  ui:
    type: ClusterIP
  manager:
    type: ClusterIP
    annotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: "9500"

persistence:
  defaultClass: true
  defaultFsType: ext4
  defaultMkfsParams: "-O ^has_journal,extent,uninit_bg -E lazy_itable_init=0,lazy_journal_init=0"
  defaultClassReplicaCount: 2
  defaultDataLocality: disabled
  defaultReplicaAutoBalance: least-effort
  reclaimPolicy: Delete
  migratable: false
  recurringJobSelector:
    enable: false
  backingImage:
    enable: false
  defaultNodeSelector:
    enable: false
  removeSnapshotsDuringFilesystemTrim: disabled

csi:
  kubeletRootDir: /var/lib/kubelet
  attacherReplicaCount: 2
  provisionerReplicaCount: 2
  resizerReplicaCount: 2
  snapshotterReplicaCount: 2
  livenessProbe:
    enabled: true
    port: 9808
    probePeriodSeconds: 10
    probeTimeoutSeconds: 3
    failureThreshold: 3
    initialDelaySeconds: 10
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

defaultSettings:
  backupTarget: ""
  backupTargetCredentialSecret: ""
  allowRecurringJobWhileVolumeDetached: true
  createDefaultDiskLabeledNodes: true
  defaultDataPath: /var/lib/longhorn
  defaultDataLocality: disabled
  replicaSoftAntiAffinity: true
  replicaAutoBalance: least-effort
  storageOverProvisioningPercentage: "200"  # MUST be string
  storageMinimalAvailablePercentage: "10"   # MUST be string
  upgradeChecker: true
  defaultReplicaCount: 2
  defaultLonghornStaticStorageClass: longhorn-static
  backupstorePollInterval: 300
  failedBackupTTL: 1440
  restoreVolumeRecurringJobs: true
  recurringSuccessfulJobsHistoryLimit: 3
  recurringFailedJobsHistoryLimit: 3
  supportBundleFailedHistoryLimit: 3
  autoSalvage: true
  autoDeletePodWhenVolumeDetachedUnexpectedly: true
  disableSchedulingOnCordonedNode: true
  replicaZoneSoftAntiAffinity: true
  nodeDownPodDeletionPolicy: delete-both-statefulset-and-deployment-pod
  allowNodeDrainWithLastHealthyReplica: true
  mkfsExt4Parameters: -O ^has_journal,extent,uninit_bg -E lazy_itable_init=0,lazy_journal_init=0
  disableReplicaRebuild: false
  replicaReplenishmentWaitInterval: 600
  concurrentReplicaRebuildPerNodeLimit: 2
  concurrentVolumeBackupRestorePerNodeLimit: 2
  disableRevisionCounter: false
  systemManagedPodsImagePullPolicy: IfNotPresent
  allowVolumeCreationWithDegradedAvailability: true
  autoCleanupSystemGeneratedSnapshot: true
  concurrentAutomaticEngineUpgradePerNodeLimit: 2
  backingImageCleanupWaitInterval: 60
  backingImageRecoveryWaitInterval: 300
  guaranteedEngineManagerCPU: 0.25
  guaranteedReplicaManagerCPU: 0.25
  guaranteedInstanceManagerCPU: 0.25
  kubernetesClusterAutoscalerEnabled: false
  orphanAutoDeletion: true
  storageNetwork: ""
  deletingConfirmationFlag: ""
  engineReplicaTimeout: 8
  snapshotDataIntegrity: disabled
  fastReplicaRebuildEnabled: true
  replicaFileSyncHttpClientTimeout: 30

privateRegistry:
  createSecret: true
  registryUrl: docker.io
  registryUser: ""
  registryPasswd: ""
  registrySecret: ""

longhornManager:
  log:
    format: plain
  tolerations: []
  nodeSelector: {}
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

longhornDriver:
  tolerations: []
  nodeSelector: {}
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

longhornUI:
  replicas: 3
  tolerations: []
  nodeSelector: {}
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

longhornConversionWebhook:
  replicas: 2

longhornAdmissionWebhook:
  replicas: 2

longhornRecoveryBackend:
  replicas: 2

ingress:
  enabled: true
  ingressClassName: traefik
  host: longhorn.local
  tls: true
  secureBackends: true
  tlsSecret: longhorn.local-tls
  path: /
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
    cert-manager.io/cluster-issuer: letsencrypt-prod
